- alias: 'Remote external update Media Center'
  trigger:
    platform: state
    entity_id: remote.media_center
  action:
    - service: input_select.select_option
      data_template:
        entity_id: input_select.remote
        option: >
          {{ states.remote.media_center.attributes.current_activity }}

- alias: 'Remote start activity from input select media center'
  trigger:
    platform: state
    entity_id: input_select.remote
  action:
    - service: script.turn_on
      entity_id: script.input_select_harmony

- alias: 'Update Available Notifications'
  trigger:
    platform: state
    entity_id: updater.updater
  action:
    service: notify.ios_nickphonex
    data_template:
      title: 'Update Available'
      message: 'Home Assistant {{ states.updater.updater.state }}'

- alias: 'Garage temp reached desired temp'
  trigger:
    platform: mqtt
    topic: 'garage/pi/temperature'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: switch.garage_temp_monitor
        state: 'on'
      - condition: template
        value_template: '{{ states.sensor.garage_temperature.state >= states.input_number.garage_temp_desired.state }}'
  action:
    - service: switch.turn_off
      entity_id: switch.garage_temp_monitor

- alias: 'Notify garage temp monitor turned off'
  trigger:
    platform: state
    entity_id: switch.garage_temp_monitor
    from: 'on'
    to: 'off'
  action:
    service: notify.ios_nickphonex
    data_template:
      title: "Garage Monitor Turned OFF"
      message: "Temperature in the garage is {{ states.sensor.garage_temperature.state }}Â°F"

- alias: 'Home Assistant Start'
  trigger:
    platform: homeassistant
    event: start
  action:
    - service: group.set_visibility
      entity_id:
        - group.pi_apple_on
        - group.pi_boston_cream_on
        - group.pi_cherry_on
        - group.pi_derby_on
        - group.pi_elderberry_on
        - group.pi_grasshopper_on
        - group.pi_pi_on
      data:
        visible: False

- alias: 'pi is on'
  trigger:
    platform: mqtt
    topic: pis/+/last-seen
  action:
    - service: group.set_visibility
      data_template:
        entity_id: "group.pi_{{ trigger.topic.split('/')[1] | replace( '-', '_' ) }}_on"
        visible: True
    - service: group.set_visibility
      data_template:
        entity_id: "group.pi_{{ trigger.topic.split('/')[1]  | replace( '-', '_' ) }}_off"
        visible: False

- alias: 'pi not seen'
  trigger:
    platform: state
    entity_id:
      - binary_sensor.pi_apple_on
      - binary_sensor.pi_boston_cream_on
      - binary_sensor.pi_cherry_on
      - binary_sensor.pi_derby_on
      - binary_sensor.pi_elderberry_on
      - binary_sensor.pi_grasshopper_on
      - binary_sensor.pi_pi_on
    from: 'on'
    to: 'off'
  action:
    - service: group.set_visibility
      data_template:
        entity_id: "group.pi_{{ trigger.entity_id | replace( 'binary_sensor.pi_', '' ) }}"
        visible: False
    - service: group.set_visibility
      data_template:
        entity_id: "group.pi_{{ trigger.entity_id | replace( 'binary_sensor.pi_', '' ) | replace( '_on', '' ) }}_off"
        visible: True
    - service: notify.ios_nickphonex
      data_template:
        title: "Pi Offline"
        message: "{{ trigger.entity_id | replace( 'binary_sensor.pi_', '' ) | replace( '_on', '' ) }}"

- alias: 'pi disk use'
  trigger:
    platform: numeric_state
    entity_id:
      - sensor.apple_disk_use
      - sensor.boston_cream_disk_use
      - sensor.cherry_disk_use
      - sensor.derby_disk_use
      - sensor.elderberry_disk_use
      - sensor.flapper_disk_use_
      - sensor.grasshopper_disk_use
      - sensor.pi_disk_use
    above: 90
  action:
    - service: notify.ios_nickphonex
      data_template:
        title: "Pi Disk Use > 90%"
        message: "{{ trigger.entity_id | replace( 'sensor.', '' ) | replace( '_disk_use', '' ) }}"

- alias: 'door battery low'
  trigger:
     platform: numeric_state
     entity_id: sensor.door_battery
     below: 10
  action:
    - service: notify.ios_nickphonex
      data_template:
        title: "Door Battery is Low"
        message: "Door battery is at {{ states.sensor.door_battery.state }}%"

- alias: 'HA start'
  trigger:
    platform: homeassistant
    event: start
  action:
    - service: notify.ios_nickphonex
      data_template:
        title: "Home Assistant Status"
        message: "Started"

- alias: 'HA start'
  trigger:
    platform: homeassistant
    event: shutdown
  action:
    - service: notify.ios_nickphonex
      data_template:
        title: "Home Assistant Status"
        message: "Shutdown"
